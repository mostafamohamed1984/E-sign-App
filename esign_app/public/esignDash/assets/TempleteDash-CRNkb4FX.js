var S=(m,c,i)=>new Promise((o,l)=>{var x=a=>{try{d(i.next(a))}catch(f){l(f)}},h=a=>{try{d(i.throw(a))}catch(f){l(f)}},d=a=>a.done?o(a.value):Promise.resolve(a.value).then(x,h);d((i=i.apply(m,c)).next())});import{r as s,c as _,i as I,e as L,u as D,j as e}from"./index-gCIvuc3j.js";import{Q as R,B as M,Y as A}from"./react-toastify.esm-DrxuvQyl.js";import{M as G}from"./index-DgxSoOf0.js";import{C as J}from"./ConfirmDeleteModal-DP7midcs.js";import"./PurePanel-CIr7AxRQ.js";const K=({setRefreshTempletes:m})=>{const[c,i]=s.useState(!1),[o,l]=s.useState(null),[x,h]=s.useState(null),[d,a]=s.useState(!1),f=_(I),E=_(L),w=D(),j=()=>{i(!0)},y=()=>{i(!1),l(null),h(null)},g=()=>{i(!1),l(null),h(null)},T=n=>{const p=n.target.value.replace(/\s{2,}/g," ");l(p),x&&h(null)},v=n=>{const r=Array.isArray(n)?n[0]:n;console.log("Here is the navigate function",r.name),w(`/templete/${r.name}`,{state:{templete:r}})},C=()=>S(void 0,null,function*(){if(a(!0),!o)h("No value provided for templete name");else if(o.length<4)h("Enter a name with more than 4 characters");else{const n={templete_name:o,user_full_name:f,user_email:E};try{const p=yield(yield fetch("/api/method/esign_app.api.save_templete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).json();console.log(p),p.message.status<300?(M.success("Templete Created Successfully",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:A}),l(null),i(!1),m(k=>!k),a(!1),v(p.message.data)):(M.error("Error while saving templete",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:A}),a(!0))}catch(r){console.error("Error:",r),alert("An error occurred while saving the templete")}}});return s.useEffect(()=>{if(c){const n=r=>{r.key==="Enter"&&d==!1&&(a(!0),C().then(()=>a(!1)))};return window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n)}}},[c,f,o]),e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",onClick:j,children:"Add Templete"})}),e.jsx(G,{title:"Add Templete",open:c,onCancel:y,footer:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{disabled:d,onClick:C,className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",children:"Save"},"save-button"),e.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#ca2424] hover:bg-white hover:text-[#ca2424] transition-colors duration-300",onClick:g,children:"Cancel"},"cancel-button")]},"footer-buttons")],children:e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Templete Name"}),e.jsx("input",{className:"bg-[#d1e0e4] text-gray-700 focus:outline-none focus:shadow-outline border border-gray-300 rounded py-2 px-4 block w-full appearance-none",type:"text",value:o||"",onChange:T}),x&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:x})]})}),e.jsx(R,{limit:1})]})},Q=({refreshTempletes:m,setRefreshTempletes:c})=>{const i=D(),o=_(L),[l,x]=s.useState([]),[h,d]=s.useState([]),[a,f]=s.useState(!0),[E,w]=s.useState(null),[j,y]=s.useState(""),[g,T]=s.useState(""),[v,C]=s.useState(""),[n,r]=s.useState(!1),[p,k]=s.useState(null);s.useEffect(()=>{(o||m)&&S(void 0,null,function*(){try{const u=yield fetch(`/api/method/esign_app.api.get_templetes?user_mail=${o}`,{method:"GET",headers:{"Content-Type":"application/json"}}),b=yield u.json();u.status===200?(x(b.message.data),d(b.message.data)):w("Failed to fetch templates")}catch(u){w("An error occurred while fetching templates")}finally{f(!1)}})},[o,m]),s.useEffect(()=>{F()},[j,g,v,l]);const F=()=>{const t=l.filter(u=>{const b=u.templete_title.toLowerCase().includes(j.toLowerCase()),N=new Date(u.templete_created_at).toISOString().split("T")[0],H=g?N>=g:!0,P=v?N<=v:!0;return b&&H&&P});d(t)},O=t=>{i(`/templete/${t.name}`,{state:{templete:t}})},V=t=>{k(t),r(!0)},$=t=>S(void 0,null,function*(){try{if((yield fetch(`/api/method/esign_app.api.delete_esign_templete?user_mail=${o}&name=${t}`,{method:"POST",headers:{"Content-Type":"application/json"}})).ok){const b=l.filter(N=>N.name!==t);x(b),c(!0)}}catch(u){w("Error deleting template")}finally{r(!1)}}),B=()=>{y(""),T(""),C(""),d(l)};return a?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"relative mt-6 min-w-[1000px] max-w-[1000px] mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Search Templates",className:"p-2 rounded bg-[#283C42] text-white placeholder-gray-400 w-1/3",value:j,onChange:t=>y(t.target.value)}),e.jsx("input",{type:"date",className:"p-2 rounded bg-[#283C42] text-white",value:g,onChange:t=>T(t.target.value)}),e.jsx("input",{type:"date",className:"p-2 rounded bg-[#283C42] text-white",value:v,onChange:t=>C(t.target.value)}),e.jsx("button",{className:"bg-[#283C42] text-white border border-white px-4 py-2 rounded hover:bg-white hover:text-[#283C42] transition",onClick:B,children:"Show All"})]}),e.jsx("div",{className:"flex flex-wrap gap-5",children:h.map((t,u)=>e.jsxs("div",{className:"relative flex w-[200px] h-[100px]",children:[e.jsx("div",{className:"absolute top-2 right-2 cursor-pointer",onClick:()=>V(t),children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-trash-2 text-red-600",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6l-2 14H7L5 6"}),e.jsx("path",{d:"M10 11v6"}),e.jsx("path",{d:"M14 11v6"}),e.jsx("path",{d:"M18 4l-1-1h-8L7 4"})]})}),e.jsxs("div",{className:"bg-[#283C42] text-white rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300 cursor-pointer p-4",style:{width:"200px",height:"100px"},onClick:()=>O(t),children:[e.jsx("h3",{className:"mt-2 font-bold text-ellipsis overflow-hidden whitespace-nowrap",children:t.templete_title}),e.jsx("p",{className:"text-sm text-gray-500 text-ellipsis overflow-hidden whitespace-nowrap",children:new Date(t.templete_created_at).toLocaleString()})]})]},u))}),p&&e.jsx(J,{visible:n,name:p.name,message:`Are you sure you want to delete "${p.templete_title}"?`,module:"Template",onCancel:()=>r(!1),onConfirm:()=>$(p.name)})]})};function Z(){const[m,c]=s.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(K,{setRefreshTempletes:c}),e.jsx(Q,{refreshTempletes:m,setRefreshTempletes:c})]})}export{Z as default};
